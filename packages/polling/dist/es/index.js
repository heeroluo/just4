let theGlobal;"undefined"!=typeof window?theGlobal=window:void 0!==typeof global&&(theGlobal=global);const pollingTasks=[];export class Polling{constructor(t,i){this._options={interval:1e3,breakOnError:!1},this._started=!1,this._isExecuting=!1,this._shouldImmediate=!1,this._executor=t,this.updateOptions(i)}static stopAll(){for(let t=pollingTasks.length-1;t>=0;t--)pollingTasks[t].stop()}updateOptions(t){var i,s;t&&(this._options.interval=null!==(i=t.interval)&&void 0!==i?i:this._options.interval,this._options.breakOnError=null!==(s=t.breakOnError)&&void 0!==s?s:this._options.breakOnError)}_exec(){let t;try{t=this._executor.call(theGlobal)}catch(t){throw this._options.breakOnError?this.stop():this._next(),t}t&&"function"==typeof t.then?(this._isExecuting=!0,t.then((()=>{this._isExecuting=!1,this._next()}),(t=>{throw this._isExecuting=!1,this._options.breakOnError?this.stop():this._next(),t}))):this._next()}_next(){this._shouldImmediate?this._exec():this._started&&(this._timer=setTimeout((()=>{this._exec()}),this._options.interval))}_clearTimeout(){switch(typeof this._timer){case"number":window.clearTimeout(this._timer);break;case"object":clearTimeout(this._timer)}this._timer=void 0}execImmediately(){this._clearTimeout(),this._isExecuting?this._shouldImmediate=!0:this._exec()}start(){this._started||(this._started=!0,pollingTasks.push(this),this._exec())}stop(){this._clearTimeout(),this._started=!1;for(let t=pollingTasks.length-1;t>=0;t--)if(pollingTasks[t]===this){pollingTasks.splice(t,1);break}}}