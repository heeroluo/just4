import{concat}from"@just4/querystring/index";import{loadScript}from"./script";function genCallbackName(n){const t=document.createElement("a");t.href=n;const o=t.pathname.split("/"),e=o[o.length-1]||"index",c="jsonp_cb_"+(t.host.split(".").slice(0,2).join("")+e.replace(/\.\w+$/,"")).replace(/\W+/g,"");let a=c,i=1;for(;void 0!==window[a];){if(i>100){a="jsonp_cb_"+Date.now()+(1e4+(9e4*Math.random()|0));break}a=c+"_"+i++}return a}export function jsonp(n,t){return new Promise((function(o,e){const c=(null==t?void 0:t.callbackName)||genCallbackName(n);function a(){window[c]=void 0}n=concat(n,{callback:c}),window[c]=function(n){try{o(n)}catch(n){e(n)}finally{a()}},loadScript(n,t).then(null,(function(n){a(),e(n)}))}))}