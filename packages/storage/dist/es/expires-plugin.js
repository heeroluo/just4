import{StorageWrap}from"./storage-wrap";import{assignProps}from"@just4/util/object";import{isDate}from"@just4/util/type";import{addRelativeTime}from"@just4/util/date";export class ExpiresPlugin extends StorageWrap{constructor(e,t){var r;const i=assignProps({},t);i.keyPrefix=null!==(r=i.keyPrefix)&&void 0!==r?r:"__expires_of_",super(e,i)}_doGetting(e){const t=this._storage.get(e.key);if(null==t)return;const r=Number(t);!isNaN(r)&&Date.now()>r&&(e.parent.remove(e.key),e.value=null)}_doSetting(e){var t;let r=null===(t=e.options)||void 0===t?void 0:t.expires;switch(typeof r){case"number":r=new Date(r);break;case"string":r=addRelativeTime(new Date,r)}isDate(r)?r>=new Date?this._storage.set(e.key,r.getTime().toString()):e.parent.remove(e.key):this.remove(e.key)}}