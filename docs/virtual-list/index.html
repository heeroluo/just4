<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@just4/virtual-list</title><meta name="description" content="Documentation for @just4/virtual-list"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@just4/virtual-list</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1> @just4/virtual-list</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#虚拟滚动列表" id="虚拟滚动列表" style="color: inherit; text-decoration: none;">
  <h1>虚拟滚动列表</h1>
</a>
<p>本模块提供基于原生 DOM 操作的高性能虚拟滚动列表，适用于无限上拉/下拉数据列表、聊天记录等场景。</p>

<a href="#使用" id="使用" style="color: inherit; text-decoration: none;">
  <h2>使用</h2>
</a>

<a href="#安装" id="安装" style="color: inherit; text-decoration: none;">
  <h3>安装</h3>
</a>
<pre><code class="language-bash"><span class="hl-0">npm install @just4/virtual-list</span>
</code></pre>

<a href="#调用" id="调用" style="color: inherit; text-decoration: none;">
  <h3>调用</h3>
</a>
<pre><code class="language-javascript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">VirtualList</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;@just4/virtual-list&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">virtualList</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">VirtualList</span><span class="hl-0">({</span><br/><span class="hl-0">  </span><span class="hl-7">// 初始化参数</span><br/><span class="hl-0">});</span>
</code></pre>
<p>初始化参数说明：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>container</td>
<td>HTMLElement</td>
<td>滚动容器（HTML 元素）</td>
</tr>
<tr>
<td>itemKey</td>
<td>string</td>
<td>数据项的 key 属性</td>
</tr>
<tr>
<td>maxItemCount</td>
<td>number</td>
<td>最大渲染的节点数，默认为 100</td>
</tr>
<tr>
<td>prefetchDistance</td>
<td>number</td>
<td>预加载距离，为滚动容器高度的倍数。默认为 2</td>
</tr>
<tr>
<td>defaultView</td>
<td>&#39;head&#39; | &#39;foot&#39;</td>
<td>默认视图，&#39;head&#39; 表示开头，&#39;foot&#39; 表示末尾</td>
</tr>
<tr>
<td>dataSource</td>
<td>Object</td>
<td>数据源（详见下文说明）</td>
</tr>
<tr>
<td>renderer</td>
<td>Object</td>
<td>渲染器（详见下文说明）</td>
</tr>
<tr>
<td>onClick</td>
<td>Function</td>
<td>点击事件的回调函数（详见下文说明）</td>
</tr>
</tbody></table>

<a href="#关于数据源" id="关于数据源" style="color: inherit; text-decoration: none;">
  <h3>关于数据源</h3>
</a>
<p>实际项目中的数据分页方式有很多种，比如根据页码分页、根据数据的 key 属性值分页等。模块内部无法适配这么多的情况，所以提供了 <code>dataSource</code> 参数。</p>
<p><code>dataSource</code> 是一个包含以下<strong>异步方法</strong>的对象：</p>
<ul>
<li><code>loadInitialData</code>：加载初始数据。</li>
<li><code>loadNextData(ref)</code>：加载下一页数据，其中 ref 是当前最后一条数据的 key 值。</li>
<li><code>loadPreviousData(ref)</code>：加载上一页数据，其中 ref 是当前第一条数据的 key 值。</li>
</ul>
<p>以下为数据源对象的示例：</p>
<pre><code class="language-javascript"><span class="hl-7">// 数据</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">allData</span><span class="hl-0"> = [</span><br/><span class="hl-0">  </span><span class="hl-7">// 数据...</span><br/><span class="hl-0">];</span><br/><br/><span class="hl-7">// 分页的页大小</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">PAGE_SIZE</span><span class="hl-0"> = </span><span class="hl-8">50</span><span class="hl-0">;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">dataSource</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-6">loadInitialData</span><span class="hl-0">() {</span><br/><span class="hl-0">    </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-9">Promise</span><span class="hl-0">((</span><span class="hl-2">resolve</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">setTimeout</span><span class="hl-0">(</span><span class="hl-4">function</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-6">resolve</span><span class="hl-0">(</span><br/><span class="hl-0">          {</span><br/><span class="hl-0">            </span><span class="hl-2">data:</span><span class="hl-0"> </span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-6">slice</span><span class="hl-0">(</span><span class="hl-8">0</span><span class="hl-0">, </span><span class="hl-5">PAGE_SIZE</span><span class="hl-0">),</span><br/><span class="hl-0">            </span><span class="hl-2">reachedFootBoundary:</span><span class="hl-0"> </span><span class="hl-4">false</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-2">reachedHeadBoundary:</span><span class="hl-0"> </span><span class="hl-4">true</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        );</span><br/><span class="hl-0">      }, </span><span class="hl-8">500</span><span class="hl-0">);</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  },</span><br/><br/><span class="hl-0">  </span><span class="hl-6">loadNextData</span><span class="hl-0">(</span><span class="hl-2">ref</span><span class="hl-0">: </span><span class="hl-9">unknown</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-9">Promise</span><span class="hl-0">((</span><span class="hl-2">resolve</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">setTimeout</span><span class="hl-0">(</span><span class="hl-4">function</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-2">i</span><span class="hl-0"> = </span><span class="hl-8">0</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0"> &lt; </span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0">++) {</span><br/><span class="hl-0">          </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">allData</span><span class="hl-0">[</span><span class="hl-2">i</span><span class="hl-0">].</span><span class="hl-2">id</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">() === </span><span class="hl-9">String</span><span class="hl-0">(</span><span class="hl-2">ref</span><span class="hl-0">)) {</span><br/><span class="hl-0">            </span><span class="hl-6">resolve</span><span class="hl-0">(</span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-6">slice</span><span class="hl-0">(</span><span class="hl-2">i</span><span class="hl-0"> + </span><span class="hl-8">1</span><span class="hl-0">, </span><span class="hl-2">i</span><span class="hl-0"> + </span><span class="hl-8">1</span><span class="hl-0"> + </span><span class="hl-5">PAGE_SIZE</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-1">break</span><span class="hl-0">;</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">        </span><span class="hl-6">resolve</span><span class="hl-0">([]);</span><br/><span class="hl-0">      }, </span><span class="hl-8">500</span><span class="hl-0">);</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  },</span><br/><br/><span class="hl-0">  </span><span class="hl-6">loadPreviousData</span><span class="hl-0">(</span><span class="hl-2">ref</span><span class="hl-0">: </span><span class="hl-9">unknown</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-9">Promise</span><span class="hl-0">((</span><span class="hl-2">resolve</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">setTimeout</span><span class="hl-0">(</span><span class="hl-4">function</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-2">i</span><span class="hl-0"> = </span><span class="hl-8">0</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0"> &lt; </span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0">++) {</span><br/><span class="hl-0">          </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">allData</span><span class="hl-0">[</span><span class="hl-2">i</span><span class="hl-0">].</span><span class="hl-2">id</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">() === </span><span class="hl-9">String</span><span class="hl-0">(</span><span class="hl-2">ref</span><span class="hl-0">)) {</span><br/><span class="hl-0">            </span><span class="hl-6">resolve</span><span class="hl-0">(</span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-6">slice</span><span class="hl-0">(</span><span class="hl-9">Math</span><span class="hl-0">.</span><span class="hl-6">max</span><span class="hl-0">(</span><span class="hl-8">0</span><span class="hl-0">, </span><span class="hl-2">i</span><span class="hl-0"> - </span><span class="hl-5">PAGE_SIZE</span><span class="hl-0">), </span><span class="hl-2">i</span><span class="hl-0">));</span><br/><span class="hl-0">            </span><span class="hl-1">break</span><span class="hl-0">;</span><br/><span class="hl-0">          }</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">        </span><span class="hl-6">resolve</span><span class="hl-0">([]);</span><br/><span class="hl-0">      }, </span><span class="hl-8">500</span><span class="hl-0">);</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">};</span>
</code></pre>
<p>如果这三个方法返回的是空数组，则表示数据已到达边界，不会在该方向上继续加载。</p>
<p>可见，<code>dataSource</code> 是按数据 key 值的方式去分页的，如果你的项目是按页码分页，只需要在 <code>loadPreviousData</code> 和 <code>loadNextData</code> 中做一次“转换”即可。例如：</p>
<pre><code class="language-javascript"><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-2">async</span><span class="hl-0"> </span><span class="hl-6">loadNextData</span><span class="hl-0">(</span><span class="hl-2">ref</span><span class="hl-0">: </span><span class="hl-2">unknown</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-7">// ref 是最后一条数据时，要加载下一页</span><br/><span class="hl-0">    </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">ref</span><span class="hl-0"> === </span><span class="hl-2">allData</span><span class="hl-0">[</span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0"> - </span><span class="hl-8">1</span><span class="hl-0">].</span><span class="hl-2">id</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-7">// 加载下一页数据</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">nextData</span><span class="hl-0"> = </span><span class="hl-1">await</span><span class="hl-0"> </span><span class="hl-6">getData</span><span class="hl-0">(</span><span class="hl-2">page</span><span class="hl-0"> + </span><span class="hl-8">1</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">nextData</span><span class="hl-0"> &amp;&amp; </span><span class="hl-2">nextData</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-2">allData</span><span class="hl-0"> = </span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-6">concat</span><span class="hl-0">(</span><span class="hl-2">nextData</span><span class="hl-0">);</span><br/><span class="hl-0">        </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">nextData</span><span class="hl-0">;</span><br/><span class="hl-0">      } </span><span class="hl-1">else</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-1">return</span><span class="hl-0"> [];</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-1">for</span><span class="hl-0"> (</span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-2">i</span><span class="hl-0"> = </span><span class="hl-8">0</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0"> &lt; </span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-2">length</span><span class="hl-0">; </span><span class="hl-2">i</span><span class="hl-0">++) {</span><br/><span class="hl-0">      </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">allData</span><span class="hl-0">[</span><span class="hl-2">i</span><span class="hl-0">].</span><span class="hl-2">id</span><span class="hl-0"> === </span><span class="hl-2">ref</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">allData</span><span class="hl-0">.</span><span class="hl-6">slice</span><span class="hl-0">(</span><span class="hl-2">i</span><span class="hl-0"> + </span><span class="hl-8">1</span><span class="hl-0">, </span><span class="hl-2">i</span><span class="hl-0"> + </span><span class="hl-8">1</span><span class="hl-0"> + </span><span class="hl-5">PAGE_SIZE</span><span class="hl-0">);</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-1">return</span><span class="hl-0"> [];</span><br/><span class="hl-0">  },</span><br/><br/><span class="hl-0">  </span><span class="hl-7">// ...</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#渲染器" id="渲染器" style="color: inherit; text-decoration: none;">
  <h3>渲染器</h3>
</a>
<p>模块内部会把数据传入渲染器，并把渲染器返回的 DOM 节点渲染到容器内，渲染器是一个包含以下方法的对象：</p>
<ul>
<li><code>renderItems</code>：渲染数据项，需返回一个 DOM 节点的<strong>类数组或数组</strong>；</li>
<li><code>renderLoading</code>：渲染加载中界面，需返回 DOM 节点；</li>
<li><code>renderError</code>：渲染加载异常界面，需返回 DOM 节点；</li>
<li><code>renderBoundary</code>：渲染数据边界界面，需返回 DOM 节点；</li>
<li><code>renderEmpty</code>：渲染空数据提示，需返回 DOM 节点。</li>
</ul>
<p>其中 <code>renderLoading</code>、<code>renderError</code>、<code>renderBoundary</code> 的第一个参数为渲染位置：</p>
<ul>
<li><code>RenderPosition.Main</code>：主位置，指的是没有数据项时的状态；</li>
<li><code>RenderPosition.Head</code>：开头位置。</li>
<li><code>RenderPosition.Foot</code>：结尾位置。</li>
</ul>
<p>例如，如果只想在列表的结尾位置渲染边界界面，可以这么做：</p>
<pre><code class="language-javascript"><span class="hl-1">import</span><span class="hl-0"> { </span><span class="hl-2">RenderPosition</span><span class="hl-0"> } </span><span class="hl-1">from</span><span class="hl-0"> </span><span class="hl-3">&#39;@just4/virtual-list/types&#39;</span><span class="hl-0">;</span><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">renderer</span><span class="hl-0"> = {</span><br/><span class="hl-0">  </span><span class="hl-7">// ...</span><br/><br/><span class="hl-0">  </span><span class="hl-6">renderBoundary</span><span class="hl-0">(</span><span class="hl-2">position</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-1">if</span><span class="hl-0"> (</span><span class="hl-2">position</span><span class="hl-0"> === </span><span class="hl-2">RenderPosition</span><span class="hl-0">.</span><span class="hl-2">Foot</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">div</span><span class="hl-0"> = </span><span class="hl-2">document</span><span class="hl-0">.</span><span class="hl-6">createElement</span><span class="hl-0">(</span><span class="hl-3">&#39;div&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-2">div</span><span class="hl-0">.</span><span class="hl-2">className</span><span class="hl-0"> = </span><span class="hl-3">&#39;list-end&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-2">div</span><span class="hl-0">.</span><span class="hl-2">innerHTML</span><span class="hl-0"> = </span><span class="hl-3">&#39;没有更多数据了&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-1">return</span><span class="hl-0"> </span><span class="hl-2">div</span><span class="hl-0">;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">};</span>
</code></pre>

<a href="#点击事件" id="点击事件" style="color: inherit; text-decoration: none;">
  <h3>点击事件</h3>
</a>
<p>所有的点击事件都是在 <code>container</code> 上做监听的，事件参数包含三个属性：</p>
<pre><code class="language-javascript"><span class="hl-0">{</span><br/><span class="hl-0">  </span><span class="hl-2">domEvent</span><span class="hl-0">, </span><span class="hl-7">// 经过 EventWrap 包装的事件对象</span><br/><span class="hl-0">  </span><span class="hl-2">itemNode</span><span class="hl-0">, </span><span class="hl-7">// 触发事件的数据项节点</span><br/><span class="hl-0">  </span><span class="hl-2">itemData</span><span class="hl-0">  </span><span class="hl-7">// 触发事件的数据项节点对应的数据</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#其他" id="其他" style="color: inherit; text-decoration: none;">
  <h2>其他</h2>
</a>
<ul>
<li><a href="https://heeroluo.github.io/just4/virtual-list/index.html">API 文档</a></li>
</ul>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Modules</a></li><li class=" tsd-kind-module"><a href="modules/index.html">index</a></li><li class=" tsd-kind-module"><a href="modules/types.html">types</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>