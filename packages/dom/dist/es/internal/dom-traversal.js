import{mergeArray}from"@just4/util/array";import{isNode,ifIsHTMLElement,uniqueSort}from"./dom-base";import{matchesSelector}from"../selector";export function selfAndDescendants(e){if(!e)return[];const t=e;if(1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)return[t];return mergeArray([t],t.querySelectorAll("*"))}function filterBySelector(e,t){return t?e.filter((function(e){return matchesSelector(e,t)})):e}function sortAndFilter(e,t,n){return e.length?(uniqueSort(e),"parentNode"!==t&&"previousElementSibling"!==t||e.reverse(),filterBySelector(e,n)):e}export function findElementsUntil(e,t,n,r){let i;"string"==typeof n?i=function(e){return matchesSelector(e,n)}:isNode(n)?i=function(e){return e===n}:Array.isArray(n)&&(i=function(e){return-1!==n.indexOf(e)});const o=[];return ifIsHTMLElement(e,(function(e){for(;(e=e[t])&&(!i||!i(e));)o.push(e)})),sortAndFilter(o,t,r)}export function findElements(e,t,n,r){const i=[];return ifIsHTMLElement(e,(function(e){for(;(e=e[t])&&(i.push(e),!r););})),sortAndFilter(i,t,n)}export function getChildren(e,t){const n=[];return ifIsHTMLElement(e,(function(e){let t=e.firstElementChild;for(;t;)n.push(t),t=t.nextElementSibling})),uniqueSort(n),filterBySelector(n,t)}export function getSiblings(e,t){const n=[];return ifIsHTMLElement(e,(function(e){let t=e;for(;t=t.previousElementSibling;)n.push(t);for(t=e;t=t.nextElementSibling;)n.push(t)})),filterBySelector(uniqueSort(n),t)}export function getIndex(e){const t=ifIsHTMLElement(e,(function(e){const t=e.parentElement;if(t){let n=t.lastElementChild,r=t.childElementCount-1;for(;n&&n!==e;)r--,n=n.previousElementSibling;return r}}));return null==t?-1:t}