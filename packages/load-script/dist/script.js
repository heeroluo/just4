import{appendToURL}from"@just4/querystring/index";function createScript(e){const n=document.createElement("script");return e&&Object.keys(e).forEach((function(r){n[r]=e[r]})),n}const scriptLoaders=Object.create(null);export function loadScript(e,n={reusable:!1,preventCaching:!1,props:{async:!0}}){if(n.data&&(e=appendToURL(e,n.data)),!1!==n.preventReusing&&!n.preventCaching&&scriptLoaders[e])return scriptLoaders[e];const r=new Promise((function(r,t){let o,i;function c(){var e;o&&(o.onload=o.onerror=null,null===(e=o.parentNode)||void 0===e||e.removeChild(o),o=null),i&&window.clearTimeout(i)}n.preventCaching&&(e=appendToURL(e,{_:Date.now()})),o=createScript(n.props),o.onload=function(){c(),r()},o.onerror=function(){c(),t(new Error('Fail to load "'+e+'"'))},o.src=e,document.head.appendChild(o);const a=Number(null==n?void 0:n.timeout);a>0&&(i=window.setTimeout((function(){c(),t(new Error('Request "'+e+'" timeout'))}),a))}));return n.reusable&&(scriptLoaders[e]=r),r}